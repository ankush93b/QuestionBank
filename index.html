<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Question Bank</title>
  <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      text-align: center;
      background-color: #f9f9f9;
    }
    .banner {
      padding: 20px;
      font-size: 24px;
      position: relative;
    }
    .bannerimg {
      margin-top: 60px;
      
      -webkit-user-drag: none;
    }
    .bannerimg img {
      width: 450px;
    }
    .user-info {
      position: absolute;
      top: 10px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }
    .user-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid black;
      cursor: pointer;
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 40px;
      gap: 20px;
    }
    #sign-in-btn {
      color: white;
      background-color: black;
      border: none;
      border-radius: 30px;
      padding: 11px 12px;
      font-size: 13px;
      font-weight: 100;
      letter-spacing: 0.05em;
      box-shadow: 0 2px 12px rgba(46,125,255,0.11);
      transition: background 0.2s, transform 0.13s, box-shadow 0.15s;
      margin-top: 15px;
      width: auto;
      outline: none;
    }
    #sign-in-btn:hover, #sign-in-btn:focus {
      box-shadow: 0 4px 18px rgba(46,125,255,0.17);
    }
    .dropdown {
      position: relative;
      width: 350px;
    }
    .dropdown.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    .dropdown-label {
      font-weight: bold;
      margin-bottom: 8px;
      display: block;
    }
    .dropdown-toggle {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 25px;
      padding: 10px;
      cursor: pointer;
      text-align: left;
      position: relative;
    }
    .dropdown-toggle::after {
      content: "▼";
      position: absolute;
      right: 12px;
      top: 12px;
      font-size: 12px;
    }
    .dropdown-menu {
      display: none;
      position: absolute;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 25px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      width: 100%;
      top: 70px;
      z-index: 1;
      max-height: 200px;
      overflow: auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .dropdown-menu::-webkit-scrollbar {
      display: none;
    }
    .dropdown-menu div {
      padding: 10px;
      cursor: pointer;
      margin: 6px;
    }
    .dropdown-menu div:hover {
      background-color: #f0f0f0;
      margin: 6px;
      border-radius: 25px;
      font-size: 18px;
      font-weight: bold;
    }
    button {
      padding: 12px 20px;
      width: 75px;
      margin-top: 23px;
      border-radius: 25px;
      background-color: #4CAF50;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    
    /* Auth Modal Styles - MODERNIZED */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.3);
    }
    .modal-content {
      background: #fff;
      margin: 80px auto;
      padding: 32px 28px 18px 28px;
      border-radius: 18px;
      width: 350px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: relative;
      animation: fadeInUp 0.4s cubic-bezier(.55,1.3,.5,1) both;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(50px);}
      to { opacity: 1; transform: translateY(0);}
    }

    .modal-content h3 {
      margin: 0 0 12px 0;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      color: #23272f;
    }
    .auth-input-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 6px;
      margin-right: 20px;
    }
    .modal-content input {
      width: 100%;
      background: #f8fafc;
      border: 1px solid #d0d7de;
      border-radius: 9px;
      padding: 10px 12px;
      font-size: 16px;
      transition: border-color 0.2s;
      margin-bottom: 0;
      outline: none;
    }
    .modal-content input:focus {
      border-color: #4CAF50;
      background: #f0f7f0;
    }
    .auth-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      width: 100%;
      margin: 0 0 4px 0;
    }
    .auth-actions button {
      width: 48%;
      margin: 0;
      font-size: 15px;
      border-radius: 12px;
      padding: 10px 0;
      font-weight: 600;
      transition: background 0.17s;
    }
    .auth-actions button:last-child {
      background: red;
      color: white;
      border: 1px solid red;
      font-weight: 400;
    }
    .modal-content .auth-divider {
      margin: 8px 0 0 0;
      text-align: center;
      color: #aaa;
      font-size: 13px;
      letter-spacing: 0.06em;
    }
    .modal-content .auth-google {
      width: 100%;
      padding: 10px 0;
      margin: 0 0 2px 0;
      border-radius: 12px;
      border: 1px solid #d0d7de;
      background: #fff;
      color: #23272f;
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .modal-content .auth-google:hover {
      background: #f8fafc;
    }
    .modal-content .auth-google img {
      width: 20px;
      height: 20px;
      vertical-align: middle;
    }
    .modal-content .auth-link {
      font-size: 13px;
      color: #4CAF50;
      text-decoration: none;
      text-align: center;
      cursor: pointer;
      display: block;
      margin-top: 2px;
      transition: color 0.14s;
    }
    .modal-content .auth-link:hover {
      color: #2e7d32;
      text-decoration: underline;
    }
    .modal-content .auth-error {
      color: #e74c3c;
      margin: 6px 0 0 0;
      min-height: 20px;
      font-size: 14px;
      text-align: center;
    }
    
    
    #profile-dropdown {
      min-width: 170px;
      width: auto;
      position: absolute;
      right: 0;
      left: auto;
      top: 50px;
      z-index: 10;
      padding: 0;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.11);
    }
    #profile-dropdown div {
      font-size: 14px;
      font-weight: 400;
      padding-left: 20px;
      padding-bottom: 8px;
      border-radius: 15px;
      cursor: pointer;
      margin: 0;
      text-align: left;
      transition: background 0.18s, font-size 0.17s, font-weight 0.13s;
    }
    #profile-dropdown div:hover {
      background: #f0f0f0;
      font-size: 14px;
      font-weight: 700;
    }

    /* --- Overlay Profile Modal Redesigned --- */
    .profile-overlay-backdrop {
      display: none;
      position: fixed;
      z-index: 3000;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(30,30,30,0.27);
      align-items: center;
      justify-content: center;
    }
    .profile-overlay-backdrop.visible {
      display: flex;
    }
    .profile-modal-card {
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 2px 24px rgba(46,125,255,0.18);
      padding: 48px 32px 32px 32px;
      width: 100%;
      max-width: 400px;
      height: 500px;
      animation: fadeInUp 0.42s;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      outline: none;
      box-sizing: border-box;
    }
    .profile-modal-close-btn {
      position: absolute;
      right: 15px;
      top: 10px;
      background: #eee;
      border: none;
      border-radius: 60%;
      width: 30px;
      height: 30px;
      font-size: 18px;
      color: #444;
      cursor: pointer;
      z-index: 4;
      transition: background 0.16s;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0px;
      padding-bottom: 2px;
    }
    .profile-modal-close-btn:hover {
      background: red;
      color: white;
    }
    .profile-modal-avatar {
      margin-bottom: 28px;
      display: flex;
      justify-content: center;
    }
    .profile-modal-avatar img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 3px solid #222;
      object-fit: cover;
      background: #f1f1f1;
      box-shadow: 0 2px 16px rgba(0,0,0,0.08);
    }
    .profile-modal-fields {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      width: 100%;
      margin-bottom: 46px;
    }
    .profile-modal-field {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    .profile-modal-label {
      color: #555;
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 5px;
      text-align: center;
    }
    .profile-modal-value {
      font-size: 17px;
      color: #1a1a1a;
      word-break: break-all;
      text-align: center;
      background: #f7f7f7;
      border-radius: 8px;
      padding: 7px 16px;
      min-width: 120px;
      max-width: 100%;
      box-sizing: border-box;
      font-family: inherit;
    }
    .profile-modal-footer {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 0;
      position: absolute;
      left: 0;
      bottom: 28px;
    }
    .delete-account-btn {
      margin-top: 10px;
      background: #e74c3c;
      color: #fff;
      border: none;
      padding: 14px 30px;
      border-radius: 22px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.16s;
      box-shadow: 0 2px 10px rgba(231,76,60,0.09);
      letter-spacing: 0.03em;
      white-space: nowrap; /* Prevent line break */
      min-width: 180px;
    }
    .delete-account-btn:hover {
      background: black;
      color: white;
    }
    @media (max-width: 500px) {
      .profile-modal-card {
        max-width: 98vw;
        padding: 24px 5vw 24px 5vw;
      }
      .profile-modal-avatar img {
        width: 90px;
        height: 90px;
      }
      .profile-modal-footer {
        bottom: 16px;
      }
      .delete-account-btn {
        padding: 11px 18vw;
        font-size: 16px;
      }
    }
    
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="banner">
    <div class="user-info" id="user-info">
      <span id="hello-user" style="display:none;">Hello, <strong id="user-name">Username</strong></span>
      <img src="https://via.placeholder.com/40" alt="Profile Picture" id="user-pic" style="display:none; cursor:pointer;">
      <button id="sign-in-btn" onclick="showAuthModal('login')">Sign In</button>
      <div id="profile-dropdown" class="dropdown-menu" style="right:0; left:auto; top:50px; min-width:170px; display:none;">
        <div onclick="goToProfile()">My Profile</div>
        <div onclick="showUserPerformance()">Performances</div>
        
        <div onclick="logout()">Logout</div>
      </div>
    </div>
    <div class="bannerimg"><img oncontextmenu="return false;" src="images/banner.png" alt="" draggable="false"></div>
  </div>

  <!-- Redesigned Overlay Profile Modal -->
  <div class="profile-overlay-backdrop" id="profile-overlay-backdrop">
    <div class="profile-modal-card" id="profile-modal-card" tabindex="-1">
      <button class="profile-modal-close-btn" onclick="closeProfileOverlay()" aria-label="Close">&times;</button>
      <div class="profile-modal-avatar">
        <img id="my-profile-pic" src="https://via.placeholder.com/120" alt="Profile Picture">
      </div>
      <div class="profile-modal-fields">
        <div class="profile-modal-field">
          <div class="profile-modal-label">Name</div>
          <div class="profile-modal-value" id="my-profile-name">User</div>
        </div>
        <div class="profile-modal-field">
          <div class="profile-modal-label">Email</div>
          <div class="profile-modal-value" id="my-profile-email">user@email.com</div>
        </div>
        <div class="profile-modal-field">
          <div class="profile-modal-label">Member since</div>
          <div class="profile-modal-value" id="my-profile-member-since">2024-01-01</div>
        </div>
      </div>
      <div class="profile-modal-footer">
        <button class="delete-account-btn" id="delete-account-btn" type="button">Delete Account</button>
      </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Subject Dropdown -->
    <div class="dropdown" id="subjectDropdown">
      <label class="dropdown-label">Select Subject</label>
      <div class="dropdown-toggle" onclick="toggleMenu('subject')">Select Subject</div>
      <div class="dropdown-menu" id="subjectMenu">
        <div onclick="selectOption('subject', 'Banking Awareness')">Banking Awareness</div>
        <div onclick="selectOption('subject', 'Current Affairs')">Current Affairs</div>
        <div onclick="selectOption('subject', 'English')">English</div>
        <div onclick="selectOption('subject', 'General Awareness')">General Awareness</div>
        <div onclick="selectOption('subject', 'Quantitative Aptitude')">Quantitative Aptitude</div>
        <div onclick="selectOption('subject', 'Reasoning Ability')">Reasoning Ability</div>        
      </div>
    </div>
    <!-- Topic Dropdown -->
    <div class="dropdown disabled" id="topicDropdown">
      <label class="dropdown-label">Select Topic</label>
      <div class="dropdown-toggle" onclick="toggleMenu('topic')">Select Topic</div>
      <div class="dropdown-menu" id="topicMenu"></div>
    </div>
    <!-- Go Button -->
    <button id="goButton" onclick="goToPage()" disabled>Go</button>
  </div>

  <div id="modal-login" class="modal">
    <div class="modal-content">
      <h3>Sign In</h3>
      <div class="auth-input-group">
        <input type="email" id="login-email" placeholder="Email address" autocomplete="username">
        <input type="password" id="login-password" placeholder="Password" autocomplete="current-password">
      </div>
      <div class="auth-actions">
        <button onclick="login()">Sign In</button>
        <button onclick="hideAuthModal('login')">Cancel</button>
      </div>
      <div class="auth-divider">or</div>
      <button class="auth-google" onclick="loginGoogle()">
        <img src="images/google-logo.png" alt="Google">Sign in with Google
      </button>
      <a class="auth-link" onclick="switchToSignUp()">Don't have an account? Sign up</a>
      <div id="login-error" class="auth-error"></div>
    </div>
  </div>
  <div id="modal-signup" class="modal">
    <div class="modal-content">
      <h3>Sign Up</h3>
      <div class="auth-input-group">
        <input type="email" id="signup-email" placeholder="Email address" autocomplete="username">
        <input type="password" id="signup-password" placeholder="Password (min 6 chars)" autocomplete="new-password">
      </div>
      <div class="auth-actions">
        <button onclick="signup()">Sign Up</button>
        <button onclick="hideAuthModal('signup')">Cancel</button>
      </div>
      <div class="auth-divider">or</div>
      <button class="auth-google" onclick="signupGoogle()">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google">Sign up with Google
      </button>
      <a class="auth-link" onclick="switchToSignIn()">Already have an account? Sign in</a>
      <div id="signup-error" class="auth-error"></div>
    </div>
  </div>
  

  <script>
    // ---- FIREBASE CONFIGURATION ----
    const firebaseConfig = {
      apiKey: "AIzaSyBAS78y1CVF1lPppeyAojbw3k07mWW4lLk",
      authDomain: "questionbank-f047f.firebaseapp.com",
      projectId: "questionbank-f047f",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ---- DROPDOWN LOGIC ----
    const subjectTopics = {
      "Quantitative Aptitude": ['Squares upto 10','Squares upto 10 Mix','Squares upto 20', 'Squares upto 30', 'Squares upto 40','Tables upto 10','Tables upto 20','Tables upto 30','Tables upto 40'],
      "General Awareness": ['Rivers', 'Books', 'Indian States and Capitals','National Parks in India'],
      "English": ['One Word Substitution',''],
      "Banking Awareness": ['Banking Terminology', 'Full Forms'],
      "Current Affairs": ['May 2025','April 2025'],
      "Reasoning Ability": ['Alphabet Positions', 'Alphabet Positions Mix']
    };

    function toggleMenu(type) {
      const menu = document.getElementById(type + 'Menu');
      const isVisible = menu.style.display === 'block';
      closeAllMenus();
      if (!isVisible) {
        menu.style.display = 'block';
      }
    }
    function selectOption(type, value) {
      document.querySelector(`#${type}Dropdown .dropdown-toggle`).textContent = value;
      document.getElementById(type + 'Menu').style.display = 'none';

      if (type === 'subject') {
        const topicDropdown = document.getElementById('topicDropdown');
        topicDropdown.classList.remove('disabled');
        // Reset topic selection
        const toggle = topicDropdown.querySelector('.dropdown-toggle');
        toggle.textContent = 'Select Topic';
        // Clear and populate topic menu
        const topicMenu = document.getElementById('topicMenu');
        topicMenu.innerHTML = '';
        (subjectTopics[value] || []).forEach(topic => {
          const div = document.createElement('div');
          div.textContent = topic;
          div.onclick = () => selectOption('topic', topic);
          topicMenu.appendChild(div);
        });
        // Disable Go button until both are selected
        document.getElementById('goButton').disabled = true;
      }

      // Enable Go button if both selected
      const selectedSubject = document.querySelector('#subjectDropdown .dropdown-toggle').textContent;
      const selectedTopic = document.querySelector('#topicDropdown .dropdown-toggle').textContent;
      if (selectedSubject !== 'Select Subject' && selectedTopic !== 'Select Topic') {
        document.getElementById('goButton').disabled = false;
      }
    }
    function goToPage() {
    const subject = document.querySelector('#subjectDropdown .dropdown-toggle').textContent;
    const topic = document.querySelector('#topicDropdown .dropdown-toggle').textContent;

    // Check if both are selected
    if(subject === "Select Subject" || topic === "Select Topic") {
      alert("Please select both subject and topic.");
      return;
    }

    // If your filenames keep spaces and cases, use this:
    // const file = `${topic}_inst.html`;

    // If your filenames are lowercased, no spaces, use this:
    const cleanTopic = topic.replace(/\s+/g, '').replace(/[^\w]/g, '');
    const file = `${cleanTopic}_inst.html`;

    // Pass subject and topic as URL parameters!
    window.location.href = `${subject.toLowerCase()}/${file.toLowerCase()}?subject=${encodeURIComponent(subject)}&topic=${encodeURIComponent(topic)}`;
  }
    function closeAllMenus() {
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.style.display = 'none';
      });
    }
    window.addEventListener('click', function(event) {
      if (!event.target.closest('.dropdown')) {
        closeAllMenus();
      }
    });

    // ---- AUTH LOGIC ----
    function showAuthModal(type) {
      document.getElementById(`modal-${type}`).style.display = 'block';
      document.getElementById(`${type}-error`).textContent = '';
    }
    function hideAuthModal(type) {
      document.getElementById(`modal-${type}`).style.display = 'none';
      document.getElementById(`${type}-error`).textContent = '';
      // Clear input fields
      if (type === 'login') {
        document.getElementById('login-email').value = '';
        document.getElementById('login-password').value = '';
      } else {
        document.getElementById('signup-email').value = '';
        document.getElementById('signup-password').value = '';
      }
    }
    function switchToSignUp() {
      hideAuthModal('login');
      showAuthModal('signup');
    }
    function switchToSignIn() {
      hideAuthModal('signup');
      showAuthModal('login');
    }
    function login() {
      const email = document.getElementById('login-email').value;
      const pass = document.getElementById('login-password').value;
      auth.signInWithEmailAndPassword(email, pass)
        .then(() => {
          hideAuthModal('login');
        })
        .catch(e => {
          document.getElementById('login-error').textContent = e.message;
        });
    }
    function signup() {
      const email = document.getElementById('signup-email').value;
      const pass = document.getElementById('signup-password').value;
      auth.createUserWithEmailAndPassword(email, pass)
        .then(() => {
          hideAuthModal('signup');
        })
        .catch(e => {
          document.getElementById('signup-error').textContent = e.message;
        });
    }
    function loginGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then(() => { hideAuthModal('login'); })
        .catch(e => {
          document.getElementById('login-error').textContent = e.message;
        });
    }
    function signupGoogle() {
      loginGoogle();
    }  
    function showUserPerformance(){window.location.href='performance.html';}

    // ---- PROFILE DROPDOWN LOGIC ----
    const userPic = document.getElementById('user-pic');
    const profileDropdown = document.getElementById('profile-dropdown');
    userPic.addEventListener('click', function(event) {
      event.stopPropagation();
      profileDropdown.style.display = (profileDropdown.style.display === 'block') ? 'none' : 'block';
    });
    window.addEventListener('click', function(event) {
      if (!event.target.closest('#profile-dropdown') && event.target !== userPic) {
        profileDropdown.style.display = 'none';
      }
    });

    // Redesigned Overlay Profile Modal logic
    function goToProfile() {
      document.getElementById('profile-overlay-backdrop').classList.add('visible');
      profileDropdown.style.display = 'none';
      const user = auth.currentUser;
      if (!user) return;
      document.getElementById('my-profile-pic').src = user.photoURL || "https://api.dicebear.com/8.x/identicon/svg?seed=" + encodeURIComponent(user.uid);
      document.getElementById('my-profile-name').textContent = user.displayName || (user.email ? user.email.split('@')[0] : "User");
      document.getElementById('my-profile-email').textContent = user.email || "Not found";
      if (user.metadata && user.metadata.creationTime) {
        const dt = new Date(user.metadata.creationTime);
        document.getElementById('my-profile-member-since').textContent = dt.toLocaleDateString();
      }
      setTimeout(() => { document.getElementById('profile-modal-card').focus(); }, 120);
    }
    function closeProfileOverlay() {
      document.getElementById('profile-overlay-backdrop').classList.remove('visible');
    }
    document.addEventListener('keydown', function(evt) {
      if(evt.key === "Escape") closeProfileOverlay();
    });
    document.getElementById('profile-overlay-backdrop').addEventListener('mousedown', function(e) {
      if (e.target === this) closeProfileOverlay();
    });

    // Delete account logic
    async function deleteAccount() {
    if (!confirm("⚠️ Are you sure you want to delete your account? This cannot be undone.")) return;
    const user = firebase.auth().currentUser;
    if (!user) {
      alert("No user is currently signed in.");
      return;
    }

    const db = firebase.firestore();

    // Delete user data from Firestore (including nested collections)
    async function deleteUserData(uid) {
      try {
        // Delete subcollections (like "results")
        const collections = await db.collection("users").doc(uid).listCollections();
        for (const collection of collections) {
          const docs = await collection.get();
          const batch = db.batch();
          docs.forEach(doc => batch.delete(doc.ref));
          await batch.commit();
        }
        // Delete main user doc
        await db.collection("users").doc(uid).delete();
      } catch (err) {
        // Ignore Firestore errors, since user may not have data
      }
    }

    try {
      await deleteUserData(user.uid);
    } catch (err) {
      // Optionally handle error
    }

    // Delete Firebase Auth user
    user.delete().then(()=>{
      alert("✅ Account and all your data deleted.");
      closeProfileOverlay();
    }).catch(e=>{
      if (e.code === 'auth/requires-recent-login') {
        alert("↻ Please re-login before deleting your account for security.");
      } else {
        alert("Error deleting account: " + e.message);
      }
    });
  }

  // Attach the click handler
  document.getElementById('delete-account-btn').onclick = deleteAccount;

    
    
    function logout() {
      auth.signOut()
        .then(() => {})
        .catch(e => {
          alert("Error signing out: " + e.message);
        });
      profileDropdown.style.display = 'none';
      closeProfileOverlay();
    }

    // ---- AUTH STATE LISTENER ----
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('hello-user').style.display = '';
        document.getElementById('user-name').textContent = user.displayName || (user.email ? user.email.split('@')[0] : 'User');
        document.getElementById('user-pic').style.display = '';
        document.getElementById('sign-in-btn').style.display = 'none';
        document.getElementById('user-pic').src = user.photoURL || "https://api.dicebear.com/8.x/identicon/svg?seed=" + encodeURIComponent(user.uid);
        
      } else {
        document.getElementById('hello-user').style.display = 'none';
        document.getElementById('user-pic').style.display = 'none';
        document.getElementById('sign-in-btn').style.display = '';
        
        closeProfileOverlay();
        profileDropdown.style.display = 'none';
      }
    });

    // Close modal on outside click
    window.onclick = function(event) {
      ['modal-login','modal-signup','modal-profile-pic'].forEach(id=>{
        const modal = document.getElementById(id);
        if (modal && event.target == modal) modal.style.display = "none";
      });
    }
  </script>
</body>
</html>